$(function() {
	$('.save_as_draft').on('click', function(e){
	 draftForm=$('#process_draft_parishioner');
	 show_previewURL = draftForm.data('prehref');
            //console.log($('.form-group .form-control').serializeArray());
            pre_except_data = $('#process_draft_parishioner select[multiple="multiple"]').serializeArray();
            pre_inputdata = $('#process_draft_parishioner input').serializeArray();
            pre_textdata = $("#process_draft_parishioner textarea").serializeArray();
            pre_select_data = new Array();
            pre_inputchoose_data = new Array();
            pre_imgdata = new Array();

            //  user_img=$('input[name="user_image"]');
            //  if(user_img.get(0).files && user_img.get(0).files[0]){
            //      var reader = new FileReader();
            //      pre_imgdata.push({name : user_img.attr('name') , value: user_img.get(0).files[0] });
            //      }
            //      console.log(pre_imgdata);
            //pre_imgdata=$('input[name="user_image"]').get(0).files;
            $('#process_draft_parishioner select:not([multiple="multiple"])').each(function(i, v) {
                if ($(this).val() != '')
                    pre_select_data.push({ name: v.name, value: $('option:selected', this).text() });
            });
            //console.log(pre_select_data);
            $('#process_draft_parishioner input[type="radio"]:checked').each(function(i, v) {
                if ($(this).val() != '')
                    pre_inputchoose_data.push({ name: v.name, value: $(this).next('span').text() });
            });

            $('#process_draft_parishioner sacrament_received input[type="checkbox"]:checked').each(function(i, v) {
                if ($(this).val() != '')
                    pre_inputchoose_data.push({ name: v.name, value: $(this).next('span').text() });
            });

			//console.log($('#process_draft_parishioner parish_section input[type="checkbox"]:checked').val());

			 console.log(pre_inputchoose_data),

            pre_data = $.merge($.merge(pre_inputdata, pre_select_data), pre_inputchoose_data);
            pre_data = $.merge(pre_data, pre_except_data);
            pre_data = $.merge(pre_data, pre_textdata),
			//pre_data = $.merge(pre_data, pre_checkbox),
                console.log(pre_data);
                $.ajax({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    },
                    type: 'POST',
                    url: show_previewURL,
                    data: pre_data,
                    dataType: 'json',
                    success: function(response) {
                        $('#draftBody').html(response.pre_body)
                        $("#draftModal").modal("toggle");
                    }
                });
	});


    $('#process_draft_parishioner').on('submit', function(e) {
        e.preventDefault();
        draftForm = $(this);
        show_previewURL = draftForm.data('prehref');
        if (draftForm.parsley().isValid()) {
            //console.log($('.form-group .form-control').serializeArray());
            pre_except_data = $('#process_draft_parishioner select[multiple="multiple"]').serializeArray();
            pre_inputdata = $('#process_draft_parishioner input').serializeArray();
            pre_textdata = $("#process_draft_parishioner textarea").serializeArray();
            pre_select_data = new Array();
            pre_inputchoose_data = new Array();
            pre_imgdata = new Array();

            //  user_img=$('input[name="user_image"]');
            //  if(user_img.get(0).files && user_img.get(0).files[0]){
            //      var reader = new FileReader();
            //      pre_imgdata.push({name : user_img.attr('name') , value: user_img.get(0).files[0] });
            //      }
            //      console.log(pre_imgdata);
            //pre_imgdata=$('input[name="user_image"]').get(0).files;
            $('#process_draft_parishioner select:not([multiple="multiple"])').each(function(i, v) {
                if ($(this).val() != '')
                    pre_select_data.push({ name: v.name, value: $('option:selected', this).text() });
            });
            //console.log(pre_select_data);
            $('#process_draft_parishioner input[type="radio"]:checked').each(function(i, v) {
                if ($(this).val() != '')
                    pre_inputchoose_data.push({ name: v.name, value: $(this).next('span').text() });
            });

            $('#process_draft_parishioner sacrament_received input[type="checkbox"]:checked').each(function(i, v) {
                if ($(this).val() != '')
                    pre_inputchoose_data.push({ name: v.name, value: $(this).next('span').text() });
            });

			//console.log($('#process_draft_parishioner parish_section input[type="checkbox"]:checked').val());

			 console.log(pre_inputchoose_data),

            pre_data = $.merge($.merge(pre_inputdata, pre_select_data), pre_inputchoose_data);
            pre_data = $.merge(pre_data, pre_except_data);
            pre_data = $.merge(pre_data, pre_textdata),
			//pre_data = $.merge(pre_data, pre_checkbox),
                console.log(pre_data);
                $.ajax({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    },
                    type: 'POST',
                    url: show_previewURL,
                    data: pre_data,
                    dataType: 'json',
                    success: function(response) {
                        $('#preBody').html(response.pre_body)
                        $("#preAddModal").modal("toggle");
                    }
                });
        }
    });

	$('#save_draft_only').on('click', function(e){
     entered_draft_data=$('#process_draft_parishioner').serialize();
	 draft_url=$(this).data('dref');
	    $.ajax({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    },
                    type: 'PATCH',
                    url: draft_url,
                    data: entered_draft_data,
                    dataType: 'json',
                    success: function(response) {
                        if(response.success){
					    toastr.options = { "timeOut": "6000",'positionClass':'toast-bottom-right'};
                        toastr['success']('Draft datas has been inserted !','');
						 $("#draftModal").modal('hide');
						}
						if(response.error){
                        toastr.options = { "timeOut": "6000",'positionClass':'toast-bottom-right'};
                        toastr['error']('Oops..Validation Errror !','');
                       }
					   if(response.exception){
                        toastr.options = { "timeOut": "6000",'positionClass':'toast-bottom-right'};
                        toastr['error']('Oops..Mismatch found, can not be processed!','');
                       }
                    }
                });
	});

    $('#modal_draft_confirmation').on('click', function(e) {
        e.preventDefault();
        swal({
                title: "Disclaimer",
                text: "No changes would be made after submission of the form",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#009688",
                cancelButtonColor: "#009688",
                confirmButtonText: "Yes, Submit!",
                cancelButtonText: "No, cancel!",
                closeOnConfirm: false,
                animation: "slide-from-top",
                closeOnCancel: true,
                //imageUrl: '<i class="fa fa-info">'
            },
            function(inputValue) {
                if (inputValue) {
                    $('#process_draft_parishioner').off('submit').submit();
                }
            });
    });
});
